# Aegis V4 — Engineering Ledger

| Date | Component | Issue | Resolution |
|---|---|---|---|
| 2026-02-26 | Phase 0 | Initial setup | Rhinestone module-template scaffolded via `forge init` |
| 2026-02-26 | Phase 0 | `UserOpGasLog.sol` solar linter import error | Patched import path from `src/external/ERC4337.sol` → `modulekit/external/ERC4337.sol` |
| 2026-02-26 | Phase 2 | `viem.parseAbiParameters` TS type error in Jest | Replaced `parseAbiParameters("uint256, uint256")` with `[{ type: "uint256" }, { type: "uint256" }]` inline objects |
| 2026-02-26 | Phase 4 | `e2e_mock_simulation.ts` viem type errors in ts-node | Added `// @ts-nocheck` — simulation scripts are runtime, not library code |
| 2026-02-27 | Phase 5 | `cre workflow simulate --target` failing with "target not found" | The `--target` flag maps to the **top-level YAML key** in `workflow.yaml` and `project.yaml`, not a `targets:` section or `settings/` subfolder. V3 working format: `tenderly-fork:` as the root key |
| 2026-02-27 | Phase 5 | `cre workflow simulate` failing with WASM compile error | `bun x cre-setup` must be run inside the Docker container before first simulate to download the Javy plugin WASM |
| 2026-02-27 | Phase 5 | CRE simulate ABI mismatch concern | V4 `onReport(uint256 tradeId, uint256 riskScore)` ABI is identical to V3 — no change needed in oracle encoding |
| 2026-02-27 | Demo Scripts | `runtime.log()` inside the CRE **handler function** is silently suppressed in `--non-interactive`/simulate mode | Only `nodeRuntime.log()` inside `runInNodeMode()` appears as `[USER LOG]` in terminal output. All verbose AI/BaseScan logging must live inside a `runInNodeMode` callback to be visible. |
| 2026-02-27 | Demo Scripts | CRE `cre workflow simulate` caches compiled WASM and does not recompile on source changes | Cache is at `/root/.cre/`. Delete files with `docker exec aegis-oracle-node bash -c "find /root/.cre -type f ! -name 'cre.yaml' ! -name 'update.json' \| xargs rm -f"` before re-running after source changes. |
| 2026-02-27 | Demo Scripts | Mock token source strings were one-liners — AI had nothing to analyze | Replace mock `source` fields in `MOCK_REGISTRY` with full realistic malicious Solidity (allowlist-only `_update`, obfuscated `_taxBasisPoints`) so GPT-4o/Llama-3 can independently flag the risks. |
| 2026-02-27 | Demo Scripts | `runtime.log()` AI exclusion bug — `!(mockData && targetAddress === "0x...000b")` explicitly skipped AI for HoneypotCoin | Removed the exclusion: all tokens with source code (mock or real) must go through the full AI pipeline. |
| 2026-02-27 | Demo Scripts | Demo scripts hard-coded `tradeId=0` for `onReportDirect` — stale on repeated runs | Fixed: read `nextTradeId()` from chain at script start and offset all tradeId references dynamically. |
| 2026-02-27 | Tenderly | Previous Tenderly VNet ran out of blocks mid-demo-run | New VNet provisioned via `new_tenderly_testnet.ps1` — also fixed `KeystoneForwarder` placeholder address (`0x000...001`) to real address. |
| 2026-02-27 | Demo Scripts | Good tokens to demonstrate real oracle: **BRETT** (`0x532f27101965dd16442E59d40670FaF5eBB142E4`) and **TOSHI** (`0xAC1Bd2486aAf3B5C0fc3Fd868558b082a531B2B4`) | Both verified on BaseScan, so ConfidentialHTTP fetch returns real source. AI independently reasons about them. Malicious tokens must use `MOCK_REGISTRY` with full Solidity source. |
| 2026-02-27 | Demo Scripts | Demo scripts must NEVER mention prize money amounts (e.g. "$17K", "$5K") | Looks unprofessional and presumptuous during a video recording intended for judges. Remove any "Track eligibility" or prize sections from closing cards entirely. |
| 2026-02-27 | Tenderly | Tenderly VNets run out of blocks frequently during development | Always keep `new_tenderly_testnet.ps1` handy. When blocks run out: run the script, it auto-updates `.env`, `workflow.yaml`, `config.json`, and redeploys `AegisModule`. Then verify the contract and restart Docker. Update all UUID references in demo scripts. || 2026-02-27 | CRE Oracle | Llama-3 flagged standard OpenZeppelin `Ownable` (transferOwnership/renounceOwnership) as `privilegeEscalation=true` for clean tokens like BRETT | AI prompt must explicitly state: "Standard OpenZeppelin Ownable is NORMAL BEST PRACTICE and is NOT privilege escalation — only flag if owner can drain ALL user balances or mint unlimited tokens via a hidden backdoor" |
| 2026-02-27 | CRE Oracle | `cre workflow simulate` is a **dry-run** — the oracle's `onReport()` call inside the simulation does NOT write to the real chain | After CRE simulate, parse `Final Risk Code` from `[USER LOG]` output and call `onReportDirect(tradeId, riskCode)` with the correct ABI `(uint256, uint256)` to commit the oracle verdict on-chain. Wrong ABI (`address,uint8,uint64`) silently reverts with no error. |
| 2026-02-27 | CRE Oracle | `cre workflow simulate` "receipt not found" for tx hashes emitted on old/cleared VNets | Always emit `requestAudit` on the **current active VNet** and pass that tx hash directly to `cre workflow simulate` in the same script run. Stale hashes from deleted VNets are irrecoverable. |
| 2026-02-27 | Token Discovery | Confirmed clean Base tokens (all pass GPT-4o + Llama-3 with Risk Code 0, isApproved=TRUE): **BRETT** `0x532f27101965dd16442E59d40670FaF5eBB142E4`, **TOSHI** `0xAC1Bd2486aAf3B5C0fc3Fd868558b082a531B2B4`, **DEGEN** `0x4ed4E862860beD51a9570b96d89aF5E1B0Efefed`, **WETH** `0x4200000000000000000000000000000000000006` | Use these for demos requiring cleared tokens. Mock tokens (TaxToken, HoneypotCoin) must have full Solidity source in `MOCK_REGISTRY`. LINK on Base reverts on `requestAudit` — bridged token incompatibility. |
| 2026-02-27 | Frontend / CSS Specificity | Tailwind `space-y-*` classes had no visible effect even when increased multiple times (`space-y-5` → `space-y-7` → `space-y-10`) | **Root cause:** The `.card` class in `globals.css` sets concrete `margin-top`/`margin-bottom` pixel values. Tailwind `space-y-*` works via a `> * + *` selector — but `.card`'s own margin declarations win due to CSS specificity and load order. **Fix:** Apply spacing directly as **inline styles** (`style={{ marginBottom: '24px' }}`). Inline styles always override class-level rules. **Lesson:** When a Tailwind spacing utility has no visible effect, stop increasing the class number and switch to `style={{}}` — then confirm in DevTools that the computed margin actually changed. |

