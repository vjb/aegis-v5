PASS test/frontend.spec.ts (48.834 s)
PASS test/bot.spec.ts (49.198 s)
PASS test/oracle.spec.ts
PASS test/bot_v5.spec.ts (52.158 s)
PASS test/session_key.spec.ts (52.259 s)
PASS test/safe_setup.spec.ts
PASS test/x402/OracleMonetizationLive.spec.ts (54.641 s)
  ● Console

    console.log
      [x402] 402 Response: {
        "x402Version": 1,
        "error": "X-PAYMENT header is required",
        "accepts": [
          {
            "scheme": "exact",
            "network": "base-sepolia",
            "maxAmountRequired": "50000",
            "resource": "http://localhost:3000/api/oracle/audit",
            "description": "Aegis CRE Oracle Audit — 8-bit risk analysis via GoPlus + GPT-4o",
            "mimeType": "application/json",
            "payTo": "0x109D8072B1762263ed094BC05c5110895Adc65Cf",
            "maxTimeoutSeconds": 300,
            "asset": "0x036CbD53842c5426634e7929541eC2318f3dCF7e",
            "outputSchema": {
              "input": {
                "type": "http",
                "method": "GET",
                "discoverable": true
              }
            },
            "extra": {
              "name": "USDC",
              "version": "2"
            }
          }
        ]
      }

      at Object.<anonymous> (test/x402/OracleMonetizationLive.spec.ts:42:17)

    console.log
      [x402] Content-Type: application/json

      at Object.<anonymous> (test/x402/OracleMonetizationLive.spec.ts:68:17)

    console.log
      [x402] All headers: {
        connection: 'keep-alive',
        'content-type': 'application/json',
        date: 'Sun, 01 Mar 2026 21:39:01 GMT',
        'keep-alive': 'timeout=5',
        'transfer-encoding': 'chunked',
        vary: 'rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch'
      }

      at Object.<anonymous> (test/x402/OracleMonetizationLive.spec.ts:69:17)

    console.log
      [x402] Full 402 body: {
        "x402Version": 1,
        "error": "X-PAYMENT header is required",
        "accepts": [
          {
            "scheme": "exact",
            "network": "base-sepolia",
            "maxAmountRequired": "50000",
            "resource": "http://localhost:3000/api/oracle/audit",
            "description": "Aegis CRE Oracle Audit — 8-bit risk analysis via GoPlus + GPT-4o",
            "mimeType": "application/json",
            "payTo": "0x109D8072B1762263ed094BC05c5110895Adc65Cf",
            "maxTimeoutSeconds": 300,
            "asset": "0x036CbD53842c5426634e7929541eC2318f3dCF7e",
            "outputSchema": {
              "input": {
                "type": "http",
                "method": "GET",
                "discoverable": true
              }
            },
            "extra": {
              "name": "USDC",
              "version": "2"
            }
          }
        ]
      }

      at Object.<anonymous> (test/x402/OracleMonetizationLive.spec.ts:77:17)

PASS test/session_install.spec.ts (56.341 s)
PASS test/cre/HeimdallLive.spec.ts (66.54 s)
  ● Console

    console.log
      [TEST] Decompiled 19666 hex chars → 15000 chars in 4898ms

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:89:17)

    console.log
      [TEST] First 300 chars:
      // SPDX-License-Identifier: MIT
      pragma solidity >=0.8.0;
      
      /// @title            Decompiled Contract
      /// @author           Jonathan Becker <jonathan@jbecker.dev>
      /// @custom:version   heimdall-rs v0.9.2
      ///
      /// @notice           This contract was decompiled using the heimdall-rs decompiler.
      ///

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:90:17)

    console.log
      [TEST] Live bytecode for AegisModule: 19666 hex chars

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:120:17)

    console.log
      [TEST] Full pipeline: Base Sepolia → Heimdall → 15000 chars of decompiled code

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:147:17)

    console.log
      [TEST] Step 1: Fetched 19666 hex chars from Base Sepolia

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:169:17)

    console.log
      [TEST] Step 2: Heimdall decompiled → 8000 chars

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:180:17)

    console.log
      [TEST] Step 3: GPT-4o raw response: {
        "obfuscatedTax": false,
        "privilegeEscalation": true,
        "externalCallRisk": false,
        "logicBomb": false,
        "is_malicious": true,
        "reasoning": "The contract contains privilege escalation where only the owner can subscribe agents, indicating potential centralization and control risks."
      }

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:236:17)

    console.log
      [TEST] ✅ LLM Risk Assessment from decompiled code:

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:258:17)

    console.log
      [TEST]   obfuscatedTax: false

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:259:17)

    console.log
      [TEST]   privilegeEscalation: true

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:260:17)

    console.log
      [TEST]   externalCallRisk: false

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:261:17)

    console.log
      [TEST]   logicBomb: false

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:262:17)

    console.log
      [TEST]   8-bit risk mask: 2 (0b00000010)

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:263:17)

    console.log
      [TEST]   reasoning: The contract contains privilege escalation where only the owner can subscribe agents, indicating potential centralization and control risks.

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:264:17)


Test Suites: 9 passed, 9 total
Tests:       1 skipped, 96 passed, 97 total
Snapshots:   0 total
Time:        68.74 s
Ran all test suites.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
