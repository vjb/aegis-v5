jest-haste-map: Haste module naming collision: aegis-oracle-workflow
  The following files share their name; please adjust your hasteImpl:
    * <rootDir>\cre-node\package.json
    * <rootDir>\v3-reference\cre-node\package.json

jest-haste-map: Haste module naming collision: aegis-frontend
  The following files share their name; please adjust your hasteImpl:
    * <rootDir>\v3-reference\aegis-frontend\package.json
    * <rootDir>\aegis-frontend\package.json

PASS test/frontend.spec.ts (261.001 s)
  Phase 8.1 ‚Äî Wallet Info + Session Key Rendering
    ‚àö WalletInfo type has all required fields (733 ms)
    ‚àö truncates owner address to 0x109D‚Ä¶65Cf (4 ms)
    ‚àö truncates module address correctly (3 ms)
    ‚àö session key targets only the AegisModule (58 ms)
    ‚àö session key allows exactly 2 selectors (8 ms)
    ‚àö session key allows requestAudit (0xe34eac65) (33 ms)
    ‚àö session key allows triggerSwap (0x684bceb0) (2 ms)
    ‚àö session key does NOT allow transfer selector (6 ms)
    ‚àö session key budget is capped at 0.002 ETH (15 ms)
    ‚àö error field is optional in WalletInfo (5 ms)
  Phase 8.2 ‚Äî Oracle Feed: Risk Score & Verdict Logic
    ‚àö risk score 0 decodes to 8 all-clean checks (10 ms)
    ‚àö risk score 0 ‚Üí APPROVED verdict (27 ms)
    ‚àö risk score 4 (bit 2) ‚Üí Known Honeypot flagged (48 ms)
    ‚àö risk score 4 ‚Üí BLOCKED (1 ms)
    ‚àö risk score 36 = Honeypot (bit 2) + Privilege Escalation (bit 5) (3 ms)
    ‚àö risk score 255 flags all 8 bits (18 ms)
    ‚àö risk score 1 (bit 0) ‚Üí Unverified Code only (6 ms)
    ‚àö risk score 16 (bit 4) ‚Üí Obfuscated Tax only (2 ms)
    ‚àö risk score 128 (bit 7) ‚Üí Logic Bomb only (3 ms)
    ‚àö negative score ‚Üí ERROR verdict (1 ms)
  Phase 8.2 ‚Äî Oracle Feed: SSE Event Parsing
    ‚àö parses phase event (7 ms)
    ‚àö parses tx event with hash (3 ms)
    ‚àö parses final_verdict BLOCKED event (2 ms)
    ‚àö parses final_verdict APPROVED event (1 ms)
    ‚àö parses llm-reasoning-start for GPT-4o (2 ms)
    ‚àö parses static-analysis GoPlus event (7 ms)

PASS test/oracle.spec.ts (275.199 s)
  Aegis CRE Oracle V5 ‚Äî ABI encoding
    ‚àö encodes (tradeId=3, riskScore=0) to 64-byte ABI-encoded hex (108 ms)
    ‚àö encodes (tradeId=0, riskScore=4) ‚Äî honeypot flag (2 ms)
    ‚àö encodes riskScore=255 (all risk bits set) (2 ms)
    ‚àö oracle config vaultAddress points to AegisModule (2 ms)
    ‚àö V5 config shape has required CRE fields (6 ms)
    ‚àö V3 and V5 onReport ABI encoding is identical (same uint256,uint256 schema) (1 ms)
  Oracle AI JSON ‚Üí onReportDirect hex payload (5.5.3)
    ‚àö AI response {"risk": 5} ‚Üí correct hex payload for onReportDirect (6 ms)
    ‚àö AI response {"risk": 0} ‚Üí approved (clean token) (2 ms)
    ‚àö AI response {"risk": 36} ‚Üí denied (honeypot + privilege escalation) (2 ms)
    ‚àö calldata length is always exactly 138 chars (4+32+32 bytes) (79 ms)

PASS test/bot.spec.ts (283.607 s)
  AegisAgent V5 ‚Äî ERC-4337 Bot
    ‚àö validates required config fields exist (101 ms)
    ‚àö requestAudit calldata contains target token address (5 ms)
    ‚àö triggerSwap calldata contains token address and 1 ETH amount (5 ms)
    ‚àö agent design: gas wallet is separate from Smart Account (capital custody) (3 ms)
    ‚àö risk matrix bit decoding identifies correct flags (3 ms)
    ‚àö polling returns false if no clearance event after timeout (302 ms)

  console.log
    [TEST] Decompiled 19666 hex chars ‚Üí 15000 chars in 12680ms

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:89:17)

  console.log
    [TEST] First 300 chars:
    // SPDX-License-Identifier: MIT
    pragma solidity >=0.8.0;
    
    /// @title            Decompiled Contract
    /// @author           Jonathan Becker <jonathan@jbecker.dev>
    /// @custom:version   heimdall-rs v0.9.2
    ///
    /// @notice           This contract was decompiled using the heimdall-rs decompiler.
    ///

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:90:17)

  console.log
    [TEST] Live bytecode for AegisModule: 19666 hex chars

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:120:17)

  console.log
    [TEST] Full pipeline: Base Sepolia ‚Üí Heimdall ‚Üí 15000 chars of decompiled code

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:147:17)

  console.log
    [TEST] Step 1: Fetched 19666 hex chars from Base Sepolia

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:169:17)

  console.log
    [TEST] Step 2: Heimdall decompiled ‚Üí 8000 chars

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:180:17)

  console.log
    [TEST] Step 3: GPT-4o raw response: ```json
    {
      "obfuscatedTax": false,
      "privilegeEscalation": true,
      "externalCallRisk": false,
      "logicBomb": false,
      "reasoning": "The contract contains privilege checks that can be bypassed due to incorrect owner validation logic."
    }
    ```

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:214:17)

  console.log
    [TEST] ‚úÖ LLM Risk Assessment from decompiled code:

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:235:17)

  console.log
    [TEST]   obfuscatedTax: false

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:236:17)

  console.log
    [TEST]   privilegeEscalation: true

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:237:17)

  console.log
    [TEST]   externalCallRisk: false

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:238:17)

  console.log
    [TEST]   logicBomb: false

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:239:17)

  console.log
    [TEST]   8-bit risk mask: 2 (0b00000010)

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:240:17)

  console.log
    [TEST]   reasoning: The contract contains privilege checks that can be bypassed due to incorrect owner validation logic.

      at Object.<anonymous> (test/cre/HeimdallLive.spec.ts:241:17)

PASS test/cre/HeimdallLive.spec.ts (305.462 s)
  Phase 2: Live Heimdall Microservice
    ‚àö GET /health should return ok with Heimdall version (2694 ms)
    ‚àö POST /decompile should return decompiled logic for known bytecode (14474 ms)
    ‚àö POST /decompile should reject empty bytecode (42 ms)
  Phase 3: Live Base Sepolia Pipeline
    ‚àö should fetch live bytecode from Base Sepolia via eth_getCode (169 ms)
    ‚àö should fetch bytecode AND decompile via full pipeline (6620 ms)
  Phase 4: Live LLM Consensus Integration
    ‚àö should send Heimdall-decompiled code to live GPT-4o and get valid risk JSON (13688 ms)

PASS test/safe_setup.spec.ts (35.883 s)
  buildSafeConfig (unit)
    ‚àö returns a config with the correct owner and entry point (14 ms)
    ‚àö starts with threshold 1 (single-owner Safe) (2 ms)
  buildAegisModuleConfig (unit)
    ‚àö returns type='executor' (ERC-7579 TYPE_EXECUTOR = 2) (10 ms)
    ‚àö sets module address correctly (3 ms)
    ‚àö has zero initData for AegisModule (onInstall is a no-op) (3 ms)
  constants (unit)
    ‚àö ENTRYPOINT_V07 matches canonical ERC-4337 v0.7 address (2 ms)
  deploySafeWithAegisModule (integration ‚Äî requires BASE_SEPOLIA_RPC_URL)
    ‚óã skipped deploys a Safe and installs AegisModule as ERC-7579 Executor

PASS test/bot_v5.spec.ts (322.872 s)
  buildV5RequestAuditCall (unit)
    ‚àö targets AegisModule (NOT the Safe directly) (303 ms)
    ‚àö attaches zero ETH value (treasury pays, not the agent) (3 ms)
    ‚àö encodes requestAudit(address) selector correctly (2 ms)
    ‚àö encodes the token address as the only argument (2 ms)
  buildV5TriggerSwapCall (unit)
    ‚àö targets AegisModule (6 ms)
    ‚àö attaches zero ETH value (module treasury provides ETH for swaps) (3 ms)
    ‚àö encodes triggerSwap(address,uint256,uint256) ‚Äî 3 params (3 ms)
    ‚àö defaults amountOutMinimum to 1 (contract requires non-zero) (4 ms)
    ‚àö is distinct from requestAudit calldata (different selector) (11 ms)
  Legacy vs V5 call structure
    ‚àö V5 triggerSwap has 3 params, legacy bot.ts ABI had only 2 (bug fixed) (9 ms)
  ERC-7715 Session Key Constraints (5.5.2)
    ‚àö session key targets ONLY the AegisModule address (4 ms)
    ‚àö session permits exactly 2 selectors: requestAudit + triggerSwap (205 ms)
    ‚àö session DOES NOT permit arbitrary function selectors (e.g. ETH drain) (2 ms)
    ‚àö session DOES NOT permit calling a random contract (only AegisModule) (1 ms)
    ‚àö session uses the SmartSessionsValidator (Rhinestone canonical) (1 ms)
    ‚àö session key = agent public address (embedded in initData) (1 ms)

PASS test/session_install.spec.ts (356.036 s)
  SmartSessionValidator Integration (Base Sepolia)
    ‚àö SmartSessionValidator is installed on Safe as validator module (141 ms)
    ‚àö AegisModule is still installed as executor module (1 ms)
    ‚àö Agent wallet is subscribed with non-zero budget (1 ms)
    ‚àö Agent can requestAudit via UserOp (session key scoped) (2 ms)
    ‚àö Agent can triggerSwap via UserOp after clearance (1 ms)
    ‚àö Agent cannot call withdrawETH (not in session scope) (1 ms)
    ‚àö Agent cannot call revokeAgent (not in session scope) (2 ms)
    ‚àö buildAgentSession produces valid session for agent (1 ms)

FAIL test/live_e2e.spec.ts (364.928 s)
  Live CRE E2E Integration (Base Sepolia)
    √ó requestAudit(MockBRETT) emits AuditRequested (341 ms)
    √ó onReportDirect(riskScore=0) approves clean token (684 ms)
    √ó triggerSwap(MockBRETT) succeeds via UserOp after approval (1 ms)
    √ó onReportDirect(riskScore=4) denies honeypot token (1 ms)
    √ó triggerSwap(MockHoneypot) reverts with TokenNotCleared (1 ms)

  ‚óè Live CRE E2E Integration (Base Sepolia) ‚Ä∫ requestAudit(MockBRETT) emits AuditRequested

    TransactionExecutionError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.
     
    Request Arguments:
      from:   0x109D8072B1762263ed094BC05c5110895Adc65Cf
      to:     0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89
      value:  0.005 ETH

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getTransactionError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:44:10)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:366:30)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InsufficientFundsError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getNodeError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getNodeError.ts:103:12)
      at node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:37:31
      at getTransactionError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:43:5)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:366:30)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    EstimateGasExecutionError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.
     
    Estimate Gas Arguments:
      from:                  0x109D8072B1762263ed094BC05c5110895Adc65Cf
      to:                    0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89
      value:                 0.005 ETH
      maxFeePerGas:          0.007 gwei
      maxPriorityFeePerGas:  0.001 gwei
      nonce:                 156

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getEstimateGasError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:42:10)
      at estimateGas (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/public/estimateGas.ts:223:30)
      at prepareTransactionRequest (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/prepareTransactionRequest.ts:579:19)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:313:23)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InsufficientFundsError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getNodeError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getNodeError.ts:103:12)
      at node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:35:31
      at getEstimateGasError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:41:5)
      at estimateGas (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/public/estimateGas.ts:223:30)
      at prepareTransactionRequest (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/prepareTransactionRequest.ts:579:19)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:313:23)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InvalidInputRpcError: Missing or invalid parameters.
    Double check you have provided the correct parameters.

    URL: https://sepolia.base.org
    Request body: {"method":"eth_estimateGas","params":[{"from":"0x109D8072B1762263ed094BC05c5110895Adc65Cf","maxFeePerGas":"0x6acfc0","maxPriorityFeePerGas":"0xf4240","nonce":"0x9c","to":"0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89","value":"0x11c37937e08000"}]}

    Details: insufficient funds for transfer
    Version: viem@2.46.3

      at delay.count.count (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/buildRequest.ts:176:25)
      at attemptRetry (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/promise/withRetry.ts:44:22)

    Cause:
    RpcRequestError: RPC Request failed.

    URL: https://sepolia.base.org
    Request body: {"method":"eth_estimateGas","params":[{"from":"0x109D8072B1762263ed094BC05c5110895Adc65Cf","maxFeePerGas":"0x6acfc0","maxPriorityFeePerGas":"0xf4240","nonce":"0x9c","to":"0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89","value":"0x11c37937e08000"}]}

    Details: insufficient funds for transfer
    Version: viem@2.46.3

      at request (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/clients/transports/http.ts:157:19)
      at delay.count.count (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/buildRequest.ts:153:22)
      at attemptRetry (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/promise/withRetry.ts:44:22)

  ‚óè Live CRE E2E Integration (Base Sepolia) ‚Ä∫ onReportDirect(riskScore=0) approves clean token

    TransactionExecutionError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.
     
    Request Arguments:
      from:   0x109D8072B1762263ed094BC05c5110895Adc65Cf
      to:     0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89
      value:  0.005 ETH

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getTransactionError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:44:10)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:366:30)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InsufficientFundsError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getNodeError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getNodeError.ts:103:12)
      at node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:37:31
      at getTransactionError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:43:5)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:366:30)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    EstimateGasExecutionError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.
     
    Estimate Gas Arguments:
      from:                  0x109D8072B1762263ed094BC05c5110895Adc65Cf
      to:                    0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89
      value:                 0.005 ETH
      maxFeePerGas:          0.007 gwei
      maxPriorityFeePerGas:  0.001 gwei
      nonce:                 156

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getEstimateGasError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:42:10)
      at estimateGas (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/public/estimateGas.ts:223:30)
      at prepareTransactionRequest (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/prepareTransactionRequest.ts:579:19)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:313:23)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InsufficientFundsError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getNodeError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getNodeError.ts:103:12)
      at node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:35:31
      at getEstimateGasError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:41:5)
      at estimateGas (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/public/estimateGas.ts:223:30)
      at prepareTransactionRequest (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/prepareTransactionRequest.ts:579:19)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:313:23)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InvalidInputRpcError: Missing or invalid parameters.
    Double check you have provided the correct parameters.

    URL: https://sepolia.base.org
    Request body: {"method":"eth_estimateGas","params":[{"from":"0x109D8072B1762263ed094BC05c5110895Adc65Cf","maxFeePerGas":"0x6acfc0","maxPriorityFeePerGas":"0xf4240","nonce":"0x9c","to":"0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89","value":"0x11c37937e08000"}]}

    Details: insufficient funds for transfer
    Version: viem@2.46.3

      at delay.count.count (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/buildRequest.ts:176:25)
      at attemptRetry (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/promise/withRetry.ts:44:22)

    Cause:
    RpcRequestError: RPC Request failed.

    URL: https://sepolia.base.org
    Request body: {"method":"eth_estimateGas","params":[{"from":"0x109D8072B1762263ed094BC05c5110895Adc65Cf","maxFeePerGas":"0x6acfc0","maxPriorityFeePerGas":"0xf4240","nonce":"0x9c","to":"0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89","value":"0x11c37937e08000"}]}

    Details: insufficient funds for transfer
    Version: viem@2.46.3

      at request (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/clients/transports/http.ts:157:19)
      at delay.count.count (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/buildRequest.ts:153:22)
      at attemptRetry (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/promise/withRetry.ts:44:22)

  ‚óè Live CRE E2E Integration (Base Sepolia) ‚Ä∫ triggerSwap(MockBRETT) succeeds via UserOp after approval

    TransactionExecutionError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.
     
    Request Arguments:
      from:   0x109D8072B1762263ed094BC05c5110895Adc65Cf
      to:     0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89
      value:  0.005 ETH

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getTransactionError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:44:10)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:366:30)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InsufficientFundsError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getNodeError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getNodeError.ts:103:12)
      at node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:37:31
      at getTransactionError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:43:5)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:366:30)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    EstimateGasExecutionError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.
     
    Estimate Gas Arguments:
      from:                  0x109D8072B1762263ed094BC05c5110895Adc65Cf
      to:                    0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89
      value:                 0.005 ETH
      maxFeePerGas:          0.007 gwei
      maxPriorityFeePerGas:  0.001 gwei
      nonce:                 156

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getEstimateGasError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:42:10)
      at estimateGas (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/public/estimateGas.ts:223:30)
      at prepareTransactionRequest (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/prepareTransactionRequest.ts:579:19)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:313:23)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InsufficientFundsError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getNodeError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getNodeError.ts:103:12)
      at node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:35:31
      at getEstimateGasError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:41:5)
      at estimateGas (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/public/estimateGas.ts:223:30)
      at prepareTransactionRequest (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/prepareTransactionRequest.ts:579:19)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:313:23)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InvalidInputRpcError: Missing or invalid parameters.
    Double check you have provided the correct parameters.

    URL: https://sepolia.base.org
    Request body: {"method":"eth_estimateGas","params":[{"from":"0x109D8072B1762263ed094BC05c5110895Adc65Cf","maxFeePerGas":"0x6acfc0","maxPriorityFeePerGas":"0xf4240","nonce":"0x9c","to":"0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89","value":"0x11c37937e08000"}]}

    Details: insufficient funds for transfer
    Version: viem@2.46.3

      at delay.count.count (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/buildRequest.ts:176:25)
      at attemptRetry (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/promise/withRetry.ts:44:22)

    Cause:
    RpcRequestError: RPC Request failed.

    URL: https://sepolia.base.org
    Request body: {"method":"eth_estimateGas","params":[{"from":"0x109D8072B1762263ed094BC05c5110895Adc65Cf","maxFeePerGas":"0x6acfc0","maxPriorityFeePerGas":"0xf4240","nonce":"0x9c","to":"0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89","value":"0x11c37937e08000"}]}

    Details: insufficient funds for transfer
    Version: viem@2.46.3

      at request (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/clients/transports/http.ts:157:19)
      at delay.count.count (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/buildRequest.ts:153:22)
      at attemptRetry (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/promise/withRetry.ts:44:22)

  ‚óè Live CRE E2E Integration (Base Sepolia) ‚Ä∫ onReportDirect(riskScore=4) denies honeypot token

    TransactionExecutionError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.
     
    Request Arguments:
      from:   0x109D8072B1762263ed094BC05c5110895Adc65Cf
      to:     0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89
      value:  0.005 ETH

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getTransactionError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:44:10)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:366:30)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InsufficientFundsError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getNodeError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getNodeError.ts:103:12)
      at node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:37:31
      at getTransactionError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:43:5)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:366:30)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    EstimateGasExecutionError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.
     
    Estimate Gas Arguments:
      from:                  0x109D8072B1762263ed094BC05c5110895Adc65Cf
      to:                    0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89
      value:                 0.005 ETH
      maxFeePerGas:          0.007 gwei
      maxPriorityFeePerGas:  0.001 gwei
      nonce:                 156

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getEstimateGasError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:42:10)
      at estimateGas (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/public/estimateGas.ts:223:30)
      at prepareTransactionRequest (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/prepareTransactionRequest.ts:579:19)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:313:23)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InsufficientFundsError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getNodeError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getNodeError.ts:103:12)
      at node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:35:31
      at getEstimateGasError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:41:5)
      at estimateGas (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/public/estimateGas.ts:223:30)
      at prepareTransactionRequest (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/prepareTransactionRequest.ts:579:19)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:313:23)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InvalidInputRpcError: Missing or invalid parameters.
    Double check you have provided the correct parameters.

    URL: https://sepolia.base.org
    Request body: {"method":"eth_estimateGas","params":[{"from":"0x109D8072B1762263ed094BC05c5110895Adc65Cf","maxFeePerGas":"0x6acfc0","maxPriorityFeePerGas":"0xf4240","nonce":"0x9c","to":"0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89","value":"0x11c37937e08000"}]}

    Details: insufficient funds for transfer
    Version: viem@2.46.3

      at delay.count.count (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/buildRequest.ts:176:25)
      at attemptRetry (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/promise/withRetry.ts:44:22)

    Cause:
    RpcRequestError: RPC Request failed.

    URL: https://sepolia.base.org
    Request body: {"method":"eth_estimateGas","params":[{"from":"0x109D8072B1762263ed094BC05c5110895Adc65Cf","maxFeePerGas":"0x6acfc0","maxPriorityFeePerGas":"0xf4240","nonce":"0x9c","to":"0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89","value":"0x11c37937e08000"}]}

    Details: insufficient funds for transfer
    Version: viem@2.46.3

      at request (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/clients/transports/http.ts:157:19)
      at delay.count.count (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/buildRequest.ts:153:22)
      at attemptRetry (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/promise/withRetry.ts:44:22)

  ‚óè Live CRE E2E Integration (Base Sepolia) ‚Ä∫ triggerSwap(MockHoneypot) reverts with TokenNotCleared

    TransactionExecutionError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.
     
    Request Arguments:
      from:   0x109D8072B1762263ed094BC05c5110895Adc65Cf
      to:     0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89
      value:  0.005 ETH

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getTransactionError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:44:10)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:366:30)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InsufficientFundsError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getNodeError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getNodeError.ts:103:12)
      at node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:37:31
      at getTransactionError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getTransactionError.ts:43:5)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:366:30)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    EstimateGasExecutionError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.
     
    Estimate Gas Arguments:
      from:                  0x109D8072B1762263ed094BC05c5110895Adc65Cf
      to:                    0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89
      value:                 0.005 ETH
      maxFeePerGas:          0.007 gwei
      maxPriorityFeePerGas:  0.001 gwei
      nonce:                 156

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getEstimateGasError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:42:10)
      at estimateGas (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/public/estimateGas.ts:223:30)
      at prepareTransactionRequest (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/prepareTransactionRequest.ts:579:19)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:313:23)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InsufficientFundsError: The total cost (gas * gas fee + value) of executing this transaction exceeds the balance of the account.

    This error could arise when the account does not have enough funds to:
     - pay for the total gas fee,
     - pay for the value to send.
     
    The cost of the transaction is calculated as `gas * gas fee + value`, where:
     - `gas` is the amount of gas needed for transaction to execute,
     - `gas fee` is the gas fee,
     - `value` is the amount of ether to send to the recipient.

    Details: insufficient funds for transfer
    Version: viem@2.46.3

    [0m [90m 116 |[39m
     [90m 117 |[39m         [90m// Fund module + subscribe agent[39m
    [31m[1m>[22m[39m[90m 118 |[39m         [36mconst[39m depositHash [33m=[39m [36mawait[39m walletClient[33m.[39msendTransaction({ to[33m:[39m [33mMODULE[39m[33m,[39m value[33m:[39m parseEther([32m"0.005"[39m) })[33m;[39m
     [90m     |[39m                             [31m[1m^[22m[39m
     [90m 119 |[39m         [36mawait[39m publicClient[33m.[39mwaitForTransactionReceipt({ hash[33m:[39m depositHash })[33m;[39m
     [90m 120 |[39m
     [90m 121 |[39m         [36mconst[39m subHash [33m=[39m [36mawait[39m walletClient[33m.[39mwriteContract({[0m

      at getNodeError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getNodeError.ts:103:12)
      at node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:35:31
      at getEstimateGasError (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/errors/getEstimateGasError.ts:41:5)
      at estimateGas (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/public/estimateGas.ts:223:30)
      at prepareTransactionRequest (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/prepareTransactionRequest.ts:579:19)
      at sendTransaction (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/actions/wallet/sendTransaction.ts:313:23)
      at Object.<anonymous> (test/live_e2e.spec.ts:118:29)

    Cause:
    InvalidInputRpcError: Missing or invalid parameters.
    Double check you have provided the correct parameters.

    URL: https://sepolia.base.org
    Request body: {"method":"eth_estimateGas","params":[{"from":"0x109D8072B1762263ed094BC05c5110895Adc65Cf","maxFeePerGas":"0x6acfc0","maxPriorityFeePerGas":"0xf4240","nonce":"0x9c","to":"0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89","value":"0x11c37937e08000"}]}

    Details: insufficient funds for transfer
    Version: viem@2.46.3

      at delay.count.count (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/buildRequest.ts:176:25)
      at attemptRetry (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/promise/withRetry.ts:44:22)

    Cause:
    RpcRequestError: RPC Request failed.

    URL: https://sepolia.base.org
    Request body: {"method":"eth_estimateGas","params":[{"from":"0x109D8072B1762263ed094BC05c5110895Adc65Cf","maxFeePerGas":"0x6acfc0","maxPriorityFeePerGas":"0xf4240","nonce":"0x9c","to":"0x23EfaEF29EcC0e6CE313F0eEd3d5dA7E0f5Bcd89","value":"0x11c37937e08000"}]}

    Details: insufficient funds for transfer
    Version: viem@2.46.3

      at request (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/clients/transports/http.ts:157:19)
      at delay.count.count (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/buildRequest.ts:153:22)
      at attemptRetry (node_modules/.pnpm/viem@2.46.3_typescript@4.9.5_zod@3.25.76/node_modules/viem/utils/promise/withRetry.ts:44:22)

PASS test/session_key.spec.ts (103.714 s)
  getSmartSessionValidatorModule (unit)
    ‚àö returns type=validator (not executor) (34 ms)
    ‚àö has the canonical SmartSessions validator address (16 ms)
  AegisModule function selectors (unit)
    ‚àö requestAudit(address) selector is 4 bytes (22 ms)
    ‚àö triggerSwap(address,uint256,uint256) selector is 4 bytes (1 ms)
    ‚àö selectors are distinct (no collision) (1 ms)
  buildAgentSession (unit)
    ‚àö specifies the SmartSessions validator as session validator (78 ms)
    ‚àö encodes agent address in sessionValidatorInitData (26 ms)
    ‚àö permits exactly 2 actions (requestAudit + triggerSwap) (22 ms)
    ‚àö first action targets AegisModule with requestAudit selector (1 ms)
    ‚àö second action targets AegisModule with triggerSwap selector (15 ms)
    ‚àö has a 32-byte salt (1 ms)
  SESSION_MODES (unit)
    ‚àö USE mode = 0x00 (agent presents existing signed session) (4 ms)
    ‚àö ENABLE mode = 0x01 (agent enables + uses in same UserOp) (1 ms)
    ‚àö UNSAFE_ENABLE mode = 0x02 (skip policy checks ‚Äî dev only)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Test Suites: 1 failed, 8 passed, 9 total
Tests:       5 failed, 1 skipped, 92 passed, 98 total
Snapshots:   0 total
Time:        372.554 s
Ran all test suites.
