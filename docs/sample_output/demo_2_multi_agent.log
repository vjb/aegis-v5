  ðŸ”Ž Checking Tenderly VNet health...
  âœ… VNet healthy (block: 42690874)

======================================================================
  AEGIS PROTOCOL V4  *  DEMO 2: THE FIREWALL THAT RUNS ITSELF
======================================================================

  Targets:  Risk & Compliance (16K) | DeFi & Tokenization (20K)

  Three AI agents. Three trade intents. One firewall.
  No human approval. The Chainlink CRE oracle IS the compliance desk.

  NOVA   (0.05 ETH budget) => wants BRETT        => CLEARED => real swap
  CIPHER (0.01 ETH budget) => wants TaxToken     => BLOCKED (riskScore=2)
  REX    (0.01 ETH budget) => wants HoneypotCoin => BLOCKED (riskScore=5) + bypass revert

  AegisModule: 0x46d40e0aBdA0814bb0CB323B2Bb85a129d00B0AC

  [1a] Funding treasury with 0.1 ETH...
  OK  Treasury funded: 0.1 ETH
  [1b] Funding agent gas wallets via Tenderly faucet...
  OK  Agent gas wallets funded (Tenderly testnet faucet)
  [1c] Subscribing NOVA with 0.05 ETH budget...
  OK  NOVA hired | AgentSubscribed(NOVA, 50000000000000000) emitted
  [1d] Subscribing CIPHER with 0.01 ETH budget...
  OK  CIPHER hired | AgentSubscribed(CIPHER, 10000000000000000) emitted
  [1e] Subscribing REX with 0.01 ETH budget...
  OK  REX hired | AgentSubscribed(REX, 10000000000000000) emitted
  [2a] NOVA => requestAudit(BRETT)...
  OK  NOVA => tradeId=0 | 0xe4d392486b047a33993b04eed0063f89508a1f6fc9661065e0ca5831125462c0
  [2b] CIPHER => requestAudit(TaxToken)...
  OK  CIPHER => tradeId=1 | 0x0ae036cf2641debea9d09bfac471ca5ecacf10b4ca118e399f75b10adefb0ce4
  [2c] REX => requestAudit(HoneypotCoin)...
  OK  REX => tradeId=2 | 0x85bc839d1bbbc555135555bcffd98a7af9c1e3d7ee319ec9b6b34c706bf5e775

  All three intents are queued.
  Running Chainlink CRE oracle for each token...

  --------------------------------------------------------------------
  ðŸ”— CHAINLINK CRE â€” WASM SANDBOX OUTPUT (ALL 3 AGENTS)
  --------------------------------------------------------------------

  --- CRE: BRETT ---
    2026-02-27T05:46:48Z [USER LOG] [GoPlus] Calling real API for 0x532f27101965dd16442e59d40670faf5ebb142e4...
    2026-02-27T05:46:48Z [USER LOG] [GoPlus] HTTP 200
    2026-02-27T05:46:48Z [USER LOG] [GoPlus] unverified=0 sellRestriction=0 honeypot=0 proxy=0
    2026-02-27T05:46:49Z [USER LOG] [BaseScan] Contract: BrettToken | 52963 chars of Solidity
    2026-02-27T05:46:49Z [USER LOG] [AI] â†’ GPT-4o via ConfidentialHTTPClient | AEGIS_OPENAI_SECRET stays in DON
    2026-02-27T05:46:51Z [USER LOG] [GPT-4o] HTTP 200
    2026-02-27T05:46:51Z [USER LOG] [GPT-4o] Response: {"obfuscatedTax": false, "privilegeEscalation": false, "externalCallRisk": false, "logicBomb": false, "reasoning": "The contract uses standard OpenZeppelin ERC-20 and Ownable patterns without any hidden fees, backdoors, or unguarded external calls."}
    2026-02-27T05:46:51Z [USER LOG] [GPT-4o] Risk bits â†’ tax=false priv=false extCall=false bomb=false
    2026-02-27T05:46:51Z [USER LOG] [GPT-4o] Reasoning: The contract uses standard OpenZeppelin ERC-20 and Ownable patterns without any hidden fees, backdoors, or unguarded external calls.
    2026-02-27T05:46:51Z [USER LOG] [AI] â†’ Llama-3 via Groq ConfidentialHTTPClient | AEGIS_GROQ_SECRET stays in DON
    2026-02-27T05:46:51Z [USER LOG] [Llama-3] HTTP 200
    2026-02-27T05:46:51Z [USER LOG] [Llama-3] Response: {
    2026-02-27T05:46:51Z [USER LOG] [Llama-3] Risk bits â†’ tax=false priv=false extCall=false bomb=false
    2026-02-27T05:46:51Z [USER LOG] [Llama-3] Reasoning: No malicious patterns found in the provided ERC-20 token contract.
    2026-02-27T05:46:51Z [USER LOG] [AI] Union of Fears â†’ obfuscatedTax=0 privilegeEscalation=0 externalCallRisk=0 logicBomb=0
    2026-02-27T05:46:51Z [USER LOG] âš–ï¸ Final Risk Code: 0
  CRE verdict for BRETT - riskCode=0
  --- CRE: TaxToken ---
    2026-02-27T05:46:57Z [USER LOG] [GoPlus] MOCK registry hit: TaxToken
    2026-02-27T05:46:57Z [USER LOG] [GoPlus] unverified=0 sellRestriction=1 honeypot=0
    2026-02-27T05:46:57Z [USER LOG] [AI] â†’ GPT-4o via ConfidentialHTTPClient | AEGIS_OPENAI_SECRET stays in DON
    2026-02-27T05:46:59Z [USER LOG] [GPT-4o] HTTP 200
    2026-02-27T05:46:59Z [USER LOG] [GPT-4o] Response: {
    2026-02-27T05:46:59Z [USER LOG] [GPT-4o] Risk bits â†’ tax=true priv=false extCall=false bomb=false
    2026-02-27T05:46:59Z [USER LOG] [GPT-4o] Reasoning: The contract implements an obfuscated 99% sell fee disguised as a 'protocol fee', which exceeds the firewall's maxTax limit and is not clearly named 'tax' or 'fee'.
    2026-02-27T05:46:59Z [USER LOG] [AI] â†’ Llama-3 via Groq ConfidentialHTTPClient | AEGIS_GROQ_SECRET stays in DON
    2026-02-27T05:46:59Z [USER LOG] [Llama-3] HTTP 200
    2026-02-27T05:46:59Z [USER LOG] [Llama-3] Response: {
    2026-02-27T05:46:59Z [USER LOG] [Llama-3] Risk bits â†’ tax=true priv=false extCall=false bomb=false
    2026-02-27T05:46:59Z [USER LOG] [Llama-3] Reasoning: The contract deducts a 99% 'protocol fee' from transfers, which is not clearly named 'tax' or 'fee'.
    2026-02-27T05:46:59Z [USER LOG] [AI] Union of Fears â†’ obfuscatedTax=1 privilegeEscalation=0 externalCallRisk=0 logicBomb=0
    2026-02-27T05:46:59Z [USER LOG] âš–ï¸ Final Risk Code: 18
  CRE verdict for TaxToken - riskCode=18
  --- CRE: HoneypotCoin ---
    2026-02-27T05:47:06Z [USER LOG] [GoPlus] MOCK registry hit: HoneypotCoin
    2026-02-27T05:47:06Z [USER LOG] [GoPlus] unverified=0 sellRestriction=0 honeypot=1
    2026-02-27T05:47:06Z [USER LOG] [AI] â†’ GPT-4o via ConfidentialHTTPClient | AEGIS_OPENAI_SECRET stays in DON
    2026-02-27T05:47:08Z [USER LOG] [GPT-4o] HTTP 200
    2026-02-27T05:47:08Z [USER LOG] [GPT-4o] Response:
    2026-02-27T05:47:08Z [USER LOG] [GPT-4o] Risk bits â†’ tax=false priv=false extCall=false bomb=false
    2026-02-27T05:47:08Z [USER LOG] [GPT-4o] Reasoning: The contract restricts transfers to an owner allowlist, creating a honeypot, but does not exhibit hidden fees, privilege escalation, external call risks, or logic bombs.
    2026-02-27T05:47:08Z [USER LOG] [AI] â†’ Llama-3 via Groq ConfidentialHTTPClient | AEGIS_GROQ_SECRET stays in DON
    2026-02-27T05:47:09Z [USER LOG] [Llama-3] HTTP 200
    2026-02-27T05:47:09Z [USER LOG] [Llama-3] Response: {
    2026-02-27T05:47:09Z [USER LOG] [Llama-3] Risk bits â†’ tax=false priv=false extCall=false bomb=false
    2026-02-27T05:47:09Z [USER LOG] [Llama-3] Reasoning: This contract is a honeypot token with restricted transfers to owner-approved addresses, but does not exhibit any malicious patterns.
    2026-02-27T05:47:09Z [USER LOG] [AI] Union of Fears â†’ obfuscatedTax=0 privilegeEscalation=0 externalCallRisk=0 logicBomb=0
    2026-02-27T05:47:09Z [USER LOG] âš–ï¸ Final Risk Code: 4
  CRE verdict for HoneypotCoin - riskCode=4

  --------------------------------------------------------------------

  [3a] BRETT cleared (tradeId=1, riskScore=0)...
  OK  ClearanceUpdated(BRETT, true) => NOVA is GO for launch
  [3b] TaxToken blocked (tradeId=2, riskScore=18, bit 1 = sell restriction)...
  BLOCKED  ClearanceDenied(TaxToken, 18) => CIPHER stands down
  [3c] HoneypotCoin blocked (tradeId=3, riskScore=4, bits 0+2)...
  BLOCKED  ClearanceDenied(HoneypotCoin, 4) => REX denied

  Union of Fears: if EITHER model flags a risk, the bit is set.
  BRETT's real source was read by both GPT-4o and Llama-3 from BaseScan.
  TaxToken/HoneypotCoin: full Solidity source sent to AI from MOCK_REGISTRY.
  [4a] NOVA executing real Uniswap V3 swap...
  >   cast send AegisModule 'triggerSwap(address,uint256,uint256)' BRETT 10000000000000000 1 --pk NOVA
  OK  Swap transaction confirmed on-chain
  >>  Tenderly trace: https://virtual.base.eu.rpc.tenderly.co/7222775d-7276-4069-abf2-f457bc1f6572/tx/0x7cf469a7dd88d80aaf0807255ae85d8127498e6f9b488b9a5f83cc002b4d5c4a
  >>  AegisModule BRETT balance: 0x00000000000000000000000000000000000000000000009494e89a5dbd514200
  >>  NOVA remaining budget: 0x000000000000000000000000000000000000000000000000008e1bc9bf040000 (raw wei)
  [5a] REX tries triggerSwap with NO clearance...
  REVERT: TokenNotCleared â€” REX bypass failed
  OK  Contract held. No clearance = no swap. On-chain enforcement works.
  [5b] Owner fires REX: revokeAgent(REX)...
  OK  AgentRevoked(REX) emitted. Budget = 0.
  [5c] Proving REX lockout â€” REX attempts requestAudit after revoke...
  REVERT: NotAuthorized â€” REX has zero access. Kill switch confirmed.

======================================================================
  DEMO 2 COMPLETE â€” MULTI-AGENT FIREWALL VERIFIED
======================================================================

  AGENT    TOKEN           RISK SCORE    RESULT
  -------  ----------      ----------    ------
  NOVA     BRETT           0 (clean)     OK  Swap executed
  CIPHER   TaxToken        2 (bit 1)     BLOCKED: sell restriction
  REX      HoneypotCoin    5 (bits 0+2)  BLOCKED: unverified+honeypot
  REX      (bypass)        -             REVERT: TokenNotCleared
  REX      (post-revoke)   -             REVERT: NotAuthorized

